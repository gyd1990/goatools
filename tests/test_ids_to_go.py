
import pandas.util.testing as pdt

ENSEMBL_GENE_IDS = [u'ENSG00000180008',
 u'ENSG00000167693',
 u'ENSG00000064703',
 u'ENSG00000230873',
 u'ENSG00000189292',
 u'ENSG00000110514',
 u'ENSG00000247077',
 u'ENSG00000086015',
 u'ENSG00000168032',
 u'ENSG00000142686']


IDS_TO_GO_TERMS = {u'ENSG00000064703': {u'GO:0005634',
              u'GO:0005654',
              u'GO:0005737',
              u'GO:0005829',
              u'GO:0005856',
              u'GO:0016020',
              u'GO:0032797',
              u'GO:0034719',
              u'GO:0090571',
              u'GO:0097504'},
             u'ENSG00000086015': {u'GO:0005737', u'GO:0005886', u'GO:0015630'},
             u'ENSG00000110514': {u'GO:0005737',
              u'GO:0005829',
              u'GO:0005886',
              u'GO:0016021'},
             u'ENSG00000142686': {u'GO:0005515'},
             u'ENSG00000167693': {u'GO:0005634', u'GO:0005737', u'GO:0005829'},
             u'ENSG00000168032': {u'GO:0005886', u'GO:0016021'},
             u'ENSG00000180008': {u'GO:0005737'},
             u'ENSG00000189292': {u'GO:0005576'},
             u'ENSG00000230873': {u'GO:0031110'},
             u'ENSG00000247077': {u'GO:0005739',
              u'GO:0005741',
              u'GO:0016021'}}


def test_parse_mygene_output():
    from goatools.ids_to_go import parse_mygene_output

    mygene_output = [{u'_id': u'122809',
  u'_score': 21.914225,
  u'go': {u'BP': [{u'evidence': u'IDA',
     u'id': u'GO:0007175',
     u'pubmed': 15590694,
     u'term': u'negative regulation of epidermal growth factor-activated '
              u'receptor activity'},
    {u'evidence': u'IEA',
     u'id': u'GO:0016567',
     u'term': u'protein ubiquitination'},
    {u'evidence': u'IBA',
     u'id': u'GO:0019221',
     u'term': u'cytokine-mediated signaling pathway'},
    {u'evidence': u'IEA',
     u'id': u'GO:0032436',
     u'term': u'positive regulation of proteasomal ubiquitin-dependent protein'
              u' catabolic process'},
    {u'evidence': u'IEA',
     u'id': u'GO:0035556',
     u'term': u'intracellular signal transduction'},
    {u'evidence': u'IEA',
     u'id': u'GO:0040008',
     u'term': u'regulation of growth'},
    {u'evidence': u'IBA',
     u'id': u'GO:0046426',
     u'term': u'negative regulation of JAK-STAT cascade'}],
   u'CC': {u'evidence': u'IBA', u'id': u'GO:0005737', u'term': u'cytoplasm'},
   u'MF': {u'evidence': u'IBA',
    u'id': u'GO:0004860',
    u'term': u'protein kinase inhibitor activity'}},
  u'query': u'ENSG00000180008'},
 {u'_id': u'64359',
  u'_score': 10.957756,
  u'go': {u'BP': [{u'evidence': u'IEA',
     u'id': u'GO:0016055',
     u'term': u'Wnt signaling pathway'},
    {u'evidence': u'IEA',
     u'id': u'GO:0030154',
     u'term': u'cell differentiation'},
    {u'evidence': u'ISS',
     u'id': u'GO:0030178',
     u'term': u'negative regulation of Wnt signaling pathway'},
    {u'evidence': u'ISS',
     u'id': u'GO:0031397',
     u'term': u'negative regulation of protein ubiquitination'},
    {u'evidence': u'IEA',
     u'id': u'GO:0045454',
     u'term': u'cell redox homeostasis'},
    {u'evidence': u'IEA',
     u'id': u'GO:0055114',
     u'term': u'oxidation-reduction process'},
    {u'evidence': u'ISS',
     u'id': u'GO:0072358',
     u'term': u'cardiovascular system development'},
    {u'evidence': u'IEA',
     u'id': u'GO:0098869',
     u'term': u'cellular oxidant detoxification'}],
   u'CC': [{u'evidence': u'IEA', u'id': u'GO:0005634', u'term': u'nucleus'},
    {u'evidence': u'IBA', u'id': u'GO:0005737', u'term': u'cytoplasm'},
    {u'evidence': u'IEA', u'id': u'GO:0005829', u'term': u'cytosol'}],
   u'MF': [{u'evidence': u'IBA',
     u'id': u'GO:0004791',
     u'term': u'thioredoxin-disulfide reductase activity'},
    {u'evidence': u'IEA',
     u'id': u'GO:0047134',
     u'term': u'protein-disulfide reductase activity'}]},
  u'query': u'ENSG00000167693'},
 {u'_id': u'11218',
  u'_score': 21.914143,
  u'go': {u'BP': [{u'evidence': u'IDA',
     u'id': u'GO:0000122',
     u'pubmed': 12007404,
     u'term': u'negative regulation of transcription from RNA polymerase'
              u' II promoter'},
    {u'evidence': u'TAS',
     u'id': u'GO:0000244',
     u'pubmed': 10601333,
     u'term': u'spliceosomal tri-snRNP complex assembly'},
    {u'evidence': u'IDA',
     u'id': u'GO:0000387',
     u'pubmed': 18984161,
     u'term': u'spliceosomal snRNP assembly'},
    {u'evidence': u'TAS',
     u'id': u'GO:0000387',
     u'term': u'spliceosomal snRNP assembly'},
    {u'evidence': u'TAS',
     u'id': u'GO:0006396',
     u'pubmed': 10601333,
     u'term': u'RNA processing'},
    {u'evidence': u'IEA',
     u'id': u'GO:0008285',
     u'term': u'negative regulation of cell proliferation'},
    {u'evidence': u'IBA',
     u'id': u'GO:0010501',
     u'term': u'RNA secondary structure unwinding'},
    {u'evidence': u'IGI',
     u'id': u'GO:0043065',
     u'pubmed': 16153597,
     u'term': u'positive regulation of apoptotic process'},
    {u'evidence': u'ISS',
     u'id': u'GO:0043065',
     u'term': u'positive regulation of apoptotic process'},
    {u'evidence': u'IEA', u'id': u'GO:0048477', u'term': u'oogenesis'},
    {u'evidence': u'IEA',
     u'id': u'GO:0050810',
     u'term': u'regulation of steroid biosynthetic process'},
    {u'evidence': u'TAS', u'id': u'GO:0051170', u'term': u'nuclear import'}],
   u'CC': [{u'evidence': u'IDA', u'id': u'GO:0005634', u'term': u'nucleus'},
    {u'evidence': u'TAS', u'id': u'GO:0005654', u'term': u'nucleoplasm'},
    {u'evidence': u'IDA', u'id': u'GO:0005737', u'term': u'cytoplasm'},
    {u'evidence': u'IDA',
     u'id': u'GO:0005829',
     u'pubmed': 18984161,
     u'term': u'cytosol'},
    {u'evidence': u'TAS', u'id': u'GO:0005829', u'term': u'cytosol'},
    {u'evidence': u'TAS',
     u'id': u'GO:0005856',
     u'pubmed': 10383418,
     u'term': u'cytoskeleton'},
    {u'evidence': u'IDA',
     u'id': u'GO:0016020',
     u'pubmed': 19946888,
     u'term': u'membrane'},
    {u'evidence': u'IDA',
     u'id': u'GO:0032797',
     u'pubmed': 18984161,
     u'term': u'SMN complex'},
    {u'evidence': u'IDA',
     u'id': u'GO:0034719',
     u'pubmed': 18984161,
     u'term': u'SMN-Sm protein complex'},
    {u'evidence': u'IEA',
     u'id': u'GO:0090571',
     u'term': u'RNA polymerase II transcription repressor complex'},
    {u'evidence': u'IEA',
     u'id': u'GO:0097504',
     u'term': u'Gemini of coiled bodies'}],
   u'MF': [{u'evidence': u'IEA',
     u'id': u'GO:0003677',
     u'term': u'DNA binding'},
    {u'evidence': u'TAS',
     u'id': u'GO:0004004',
     u'pubmed': 10383418,
     u'term': u'ATP-dependent RNA helicase activity'},
    {u'evidence': u'IPI',
     u'id': u'GO:0005515',
     u'pubmed': [11714716, 21800163],
     u'term': u'protein binding'},
    {u'evidence': u'IEA', u'id': u'GO:0005524', u'term': u'ATP binding'},
    {u'evidence': u'IEA',
     u'id': u'GO:0019904',
     u'term': u'protein domain specific binding'},
    {u'evidence': u'IEA',
     u'id': u'GO:0030674',
     u'term': u'protein binding, bridging'},
    {u'evidence': u'IEA',
     u'id': u'GO:0042826',
     u'term': u'histone deacetylase binding'},
    {u'evidence': u'IPI',
     u'id': u'GO:0070491',
     u'pubmed': 12007404,
     u'term': u'repressing transcription factor binding'}]},
  u'query': u'ENSG00000064703'},
 {u'_id': u'401236',
  u'_score': 21.91354,
  u'go': {u'BP': {u'evidence': u'IEA',
    u'id': u'GO:0031110',
    u'term': u'regulation of microtubule polymerization or depolymerization'}},
  u'query': u'ENSG00000230873'},
 {u'_id': u'285016',
  u'_score': 21.914143,
  u'go': {u'BP': [{u'evidence': u'IDA',
     u'id': u'GO:0010976',
     u'pubmed': 26418745,
     u'term': u'positive regulation of neuron projection development'},
    {u'evidence': u'IEA',
     u'id': u'GO:0061098',
     u'term': u'positive regulation of protein tyrosine kinase activity'},
    {u'evidence': u'IDA',
     u'id': u'GO:0070374',
     u'pubmed': 26418745,
     u'term': u'positive regulation of ERK1 and ERK2 cascade'},
    {u'evidence': u'IDA',
     u'id': u'GO:0070378',
     u'pubmed': 26418745,
     u'term': u'positive regulation of ERK5 cascade'}],
   u'CC': {u'evidence': u'IEA',
    u'id': u'GO:0005576',
    u'term': u'extracellular region'},
   u'MF': [{u'evidence': u'IDA',
     u'id': u'GO:0030298',
     u'pubmed': 26418745,
     u'term': u'receptor signaling protein tyrosine kinase activator'
              u' activity'},
    {u'evidence': u'IDA',
     u'id': u'GO:0030971',
     u'pubmed': 26418745,
     u'term': u'receptor tyrosine kinase binding'}]},
  u'query': u'ENSG00000189292'},
 {u'_id': u'8567',
  u'_score': 20.729881,
  u'go': {u'BP': [{u'evidence': u'IMP',
     u'id': u'GO:0000187',
     u'pubmed': 9115275,
     u'term': u'activation of MAPK activity'},
    {u'evidence': u'TAS',
     u'id': u'GO:0007166',
     u'pubmed': 9115275,
     u'term': u'cell surface receptor signaling pathway'},
    {u'evidence': u'TAS',
     u'id': u'GO:0010803',
     u'term': u'regulation of tumor necrosis factor-mediated signaling'
              u' pathway'},
    {u'evidence': u'IDA',
     u'id': u'GO:0032483',
     u'pubmed': 20937701,
     u'term': u'regulation of Rab protein signal transduction'},
    {u'evidence': u'IMP',
     u'id': u'GO:0042981',
     u'pubmed': 11577081,
     u'term': u'regulation of apoptotic process'},
    {u'evidence': u'IEA',
     u'id': u'GO:0043547',
     u'term': u'positive regulation of GTPase activity'},
    {u'evidence': u'IMP',
     u'id': u'GO:0051726',
     u'pubmed': 14735464,
     u'term': u'regulation of cell cycle'},
    {u'evidence': u'IMP',
     u'id': u'GO:0097194',
     u'pubmed': 14735464,
     u'term': u'execution phase of apoptosis'},
    {u'evidence': u'IMP',
     u'id': u'GO:1902041',
     u'pubmed': 9115275,
     u'term': u'regulation of extrinsic apoptotic signaling pathway via '
              u'death domain receptors'},
    {u'evidence': u'IDA',
     u'id': u'GO:2001236',
     u'pubmed': 11577081,
     u'term': u'regulation of extrinsic apoptotic signaling pathway'}],
   u'CC': [{u'evidence': u'IDA', u'id': u'GO:0005737', u'term': u'cytoplasm'},
    {u'evidence': u'TAS', u'id': u'GO:0005829', u'term': u'cytosol'},
    {u'evidence': u'IDA', u'id': u'GO:0005886', u'term': u'plasma membrane'},
    {u'evidence': u'IDA',
     u'id': u'GO:0016021',
     u'pubmed': 8988362,
     u'term': u'integral component of membrane'}],
   u'MF': [{u'evidence': u'TAS',
     u'id': u'GO:0005123',
     u'pubmed': 9115275,
     u'term': u'death receptor binding'},
    {u'evidence': u'IPI',
     u'id': u'GO:0005515',
     u'pubmed': 9115275,
     u'term': u'protein binding'},
    {u'evidence': u'IDA',
     u'id': u'GO:0017112',
     u'pubmed': 20937701,
     u'term': u'Rab guanyl-nucleotide exchange factor activity'},
    {u'evidence': u'IMP',
     u'id': u'GO:0017112',
     u'pubmed': 9115275,
     u'term': u'Rab guanyl-nucleotide exchange factor activity'},
    {u'evidence': u'TAS',
     u'id': u'GO:0030295',
     u'pubmed': 9115275,
     u'term': u'protein kinase activator activity'}]},
  u'query': u'ENSG00000110514'},
 {u'_id': u'192111',
  u'_score': 21.915276,
  u'go': {u'BP': [{u'evidence': u'IEA',
     u'id': u'GO:0006470',
     u'term': u'protein dephosphorylation'},
    {u'evidence': u'IEA',
     u'id': u'GO:0007165',
     u'term': u'signal transduction'},
    {u'evidence': u'IEA',
     u'id': u'GO:0043547',
     u'term': u'positive regulation of GTPase activity'},
    {u'evidence': u'IMP',
     u'id': u'GO:0070266',
     u'pubmed': 22265414,
     u'term': u'necroptotic process'}],
   u'CC': [{u'evidence': u'IDA',
     u'id': u'GO:0005739',
     u'term': u'mitochondrion'},
    {u'evidence': u'IEA',
     u'id': u'GO:0005741',
     u'term': u'mitochondrial outer membrane'},
    {u'evidence': u'IEA',
     u'id': u'GO:0016021',
     u'term': u'integral component of membrane'}],
   u'MF': [{u'evidence': u'IMP',
     u'id': u'GO:0005096',
     u'pubmed': 22265414,
     u'term': u'GTPase activator activity'},
    {u'evidence': u'IDA',
     u'id': u'GO:0009400',
     u'pubmed': 19590015,
     u'term': u'receptor signaling protein serine/threonine phosphatase'
              u' activity'},
    {u'evidence': u'IMP',
     u'id': u'GO:0016791',
     u'pubmed': 22265414,
     u'term': u'phosphatase activity'},
    {u'evidence': u'IDA',
     u'id': u'GO:0032403',
     u'pubmed': 22265414,
     u'term': u'protein complex binding'}]},
  u'query': u'ENSG00000247077'},
 {u'_id': u'23139',
  u'_score': 21.914759,
  u'go': {u'BP': [{u'evidence': u'ISS',
     u'id': u'GO:0006468',
     u'term': u'protein phosphorylation'},
    {u'evidence': u'IBA',
     u'id': u'GO:0007010',
     u'term': u'cytoskeleton organization'},
    {u'evidence': u'IBA',
     u'id': u'GO:0018105',
     u'term': u'peptidyl-serine phosphorylation'},
    {u'evidence': u'IBA',
     u'id': u'GO:0035556',
     u'term': u'intracellular signal transduction'},
    {u'evidence': u'ISS',
     u'id': u'GO:0045075',
     u'term': u'regulation of interleukin-12 biosynthetic process'},
    {u'evidence': u'ISS',
     u'id': u'GO:0048515',
     u'term': u'spermatid differentiation'}],
   u'CC': [{u'evidence': u'IDA', u'id': u'GO:0005737', u'term': u'cytoplasm'},
    {u'evidence': u'IEA', u'id': u'GO:0005886', u'term': u'plasma membrane'},
    {u'evidence': u'IBA',
     u'id': u'GO:0015630',
     u'term': u'microtubule cytoskeleton'}],
   u'MF': [{u'evidence': u'ISS',
     u'id': u'GO:0000287',
     u'term': u'magnesium ion binding'},
    {u'evidence': u'IBA',
     u'id': u'GO:0004674',
     u'term': u'protein serine/threonine kinase activity'},
    {u'evidence': u'IPI',
     u'id': u'GO:0005515',
     u'pubmed': 12117771,
     u'term': u'protein binding'},
    {u'evidence': u'ISS', u'id': u'GO:0005524', u'term': u'ATP binding'},
    {u'evidence': u'IBA',
     u'id': u'GO:0008017',
     u'term': u'microtubule binding'},
    {u'evidence': u'IPI',
     u'id': u'GO:0019902',
     u'pubmed': 10646847,
     u'term': u'phosphatase binding'}]},
  u'query': u'ENSG00000086015'},
 {u'_id': u'956',
  u'_score': 21.915512,
  u'go': {u'BP': [{u'evidence': u'IEA',
     u'id': u'GO:0009134',
     u'term': u'nucleoside diphosphate catabolic process'},
    {u'evidence': u'IEA',
     u'id': u'GO:0009143',
     u'term': u'nucleoside triphosphate catabolic process'}],
   u'CC': [{u'evidence': u'IEA',
     u'id': u'GO:0005886',
     u'term': u'plasma membrane'},
    {u'evidence': u'IEA',
     u'id': u'GO:0016021',
     u'term': u'integral component of membrane'}],
   u'MF': [{u'evidence': u'IEA',
     u'id': u'GO:0005524',
     u'term': u'ATP binding'},
    {u'evidence': u'IEA',
     u'id': u'GO:0017110',
     u'term': u'nucleoside-diphosphatase activity'},
    {u'evidence': u'IEA',
     u'id': u'GO:0017111',
     u'term': u'nucleoside-triphosphatase activity'}]},
  u'query': u'ENSG00000168032'},
 {u'_id': u'127703',
  u'_score': 21.91354,
  u'go': {u'MF': {u'evidence': u'IPI',
    u'id': u'GO:0005515',
    u'pubmed': [16189514, 25416956],
    u'term': u'protein binding'}},
  u'query': u'ENSG00000142686'}]

    test = parse_mygene_output(mygene_output)
    true = IDS_TO_GO_TERMS
    pdt.assert_dict_equal(test, true)


def test_gene_ids_to_go():
    from goatools import ids_to_go

    test = ids_to_go.gene_ids_to_go(ENSEMBL_GENE_IDS)

    true = IDS_TO_GO_TERMS
    pdt.assert_dict_equal(test, true)


if __name__ == '__main__':
    test_gene_ids_to_go()
    test_parse_mygene_output()